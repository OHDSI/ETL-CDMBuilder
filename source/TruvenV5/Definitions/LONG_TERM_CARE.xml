<QueryDefinition>
   <Query database="mdcd">
     SELECT
     ENROLID
     ,SVCDATE
     ,TSVCDAT
     ,FACHDID
     ,YEAR
     ,PROV_ID
     ,STDPROV
     ,RTRIM(LTRIM(ISNULL(CAST(STDPROV AS VARCHAR), ''))) + ';' + RTRIM(LTRIM(ISNULL(PROV_ID, ''))) ProviderIdKey
     ,RTRIM(LTRIM(ISNULL(PROV_ID, ''))) PROVID,
     1 priority,
     'mdcd' source,
     'LTCP' CLAIM_TYPE,
     DX1, DX2, DX3, DX4,
     PROC1,
     COPAY, COINS, DEDUCT, NETPAY, COB, REVCODE
     FROM {sc}.LONG_TERM_CARE
     JOIN {sc}._chunks ch ON ch.ChunkId = {0} AND ENROLID = ch.PERSON_ID
   </Query>
   <ConditionOccurrence>
      <ConditionOccurrenceDefinition>
         <PersonId>ENROLID</PersonId>
         <StartDate>SVCDATE</StartDate>
         <AdditionalFields>
            <string>priority</string>
            <string>FACHDID</string>
            <string>YEAR</string>
         </AdditionalFields>
         <Concepts>
            <Concept>
               <ConceptIdMappers>
                 <Mapper>
                   <Lookup>TruvenV5\Lookups\Condition.sql</Lookup>
                 </Mapper>
               </ConceptIdMappers>
               <SourceConceptIdMappers>
                 <Mapper>
                   <Lookup>TruvenV5\Lookups\ConditionSource.sql</Lookup>
                 </Mapper>
               </SourceConceptIdMappers>
               <Fields>
                  <Field key="DX1" defaultTypeId="1"/>
                  <Field key="DX2" defaultTypeId="2"/>
                  <Field key="DX3" defaultTypeId="3"/>
                  <Field key="DX4" defaultTypeId="4"/>
               </Fields>
            </Concept>
         </Concepts>
      </ConditionOccurrenceDefinition>
   </ConditionOccurrence>
   <ProcedureOccurrence>
      <ProcedureOccurrenceDefinition>
         <PersonId>ENROLID</PersonId>
         <StartDate>SVCDATE</StartDate>
         <EndDate>TSVCDAT</EndDate>
         <ProviderIdKey>ProviderIdKey</ProviderIdKey>
         <AdditionalFields>
            <string>priority</string>
            <string>FACHDID</string>
            <string>YEAR</string>
            <string>DX1</string>
            <string>PROVID</string>
            <string>STDPROV</string>
            <string>claim_type</string>
         </AdditionalFields>
         <Concepts>
            <Concept>
              <ConceptIdMappers>
                <Mapper>
                  <Lookup>TruvenV5\Lookups\Procedure.sql</Lookup>
                </Mapper>
              </ConceptIdMappers>
              <SourceConceptIdMappers>
                <Mapper>
                  <Lookup>TruvenV5\Lookups\ProcedureSource.sql</Lookup>
                </Mapper>
              </SourceConceptIdMappers>
               <Fields>
                  <Field key="PROC1" defaultTypeId="1" isNullable="true"/>
               </Fields>
            </Concept>
         </Concepts>
      </ProcedureOccurrenceDefinition>
   </ProcedureOccurrence>
   <ProcedureCost>
       <ProcedureCostDefinition>
         <PaidCopay>COPAY</PaidCopay>
         <PaidCoinsurance>COINS</PaidCoinsurance>
         <PaidTowardDeductible>DEDUCT</PaidTowardDeductible>
         <PaidByPayer>NETPAY</PaidByPayer>
         <PaidByCoordinationBenefits>COB</PaidByCoordinationBenefits>
         <Concepts>
            <Concept>
               <ConceptIdMappers>
                  <Mapper>
                    <Lookup>TruvenV5\Lookups\RevenueCode.sql</Lookup>
                  </Mapper>
               </ConceptIdMappers>
               <Fields>
                  <Field key="REVCODE"/>
               </Fields>
            </Concept>
         </Concepts>
      </ProcedureCostDefinition>
   </ProcedureCost>
   <VisitOccurrence>
      <VisitOccurrenceDefinition>
         <PersonId>ENROLID</PersonId>
         <StartDate>SVCDATE</StartDate>
         <EndDate>TSVCDAT</EndDate>
         <ProviderIdKey>ProviderIdKey</ProviderIdKey>
         <AdditionalFields>
            <string>FACHDID</string>
            <string>YEAR</string>
            <string>PROVID</string>
            <string>STDPROV</string>
            <string>source</string>
         </AdditionalFields>
         <Concepts>
            <Concept>
               <ConceptIdMappers>
                  <Mapper>
                    <Lookup>TruvenV5\Lookups\Visits.sql</Lookup>
                  </Mapper>
               </ConceptIdMappers>
               <Fields>
                  <Field key="CLAIM_TYPE" defaultTypeId="44818517"/>
               </Fields>
            </Concept>
         </Concepts>
      </VisitOccurrenceDefinition>
   </VisitOccurrence>
   <Death>
      <DeathDefinition>
         <PersonId>ENROLID</PersonId>
         <StartDate>SVCDATE</StartDate>
         <AdditionalFields>
            <string>priority</string>
            <string>FACHDID</string>
            <string>YEAR</string>
         </AdditionalFields>
         <Concepts>
            <Concept>
               <ConceptIdMappers>
                  <Mapper>
                    <Lookup>TruvenV5\Lookups\DeathCodes.sql</Lookup>
                  </Mapper>
               </ConceptIdMappers>
               <Fields>
                  <Field key="DX1" defaultTypeId="38003567"/>
                  <Field key="DX2" defaultTypeId="38003567"/>
                  <Field key="DX3" defaultTypeId="38003567"/>
                  <Field key="DX4" defaultTypeId="38003567"/>
               </Fields>
            </Concept>
         </Concepts>
      </DeathDefinition>
   </Death>
</QueryDefinition>
